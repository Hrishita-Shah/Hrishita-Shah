# .github/workflows/update-stats.yml
name: Update GitHub Stats

on:
  schedule:
    - cron: '0 0 * * *'  # Runs every day at 00:00 UTC
  workflow_dispatch: # Allows manual trigger
  push:
    branches: [ main ] # Runs on push to main branch

jobs:
  update-stats:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GH_TOKEN }}
        
    - name: Update README with GitHub Stats
      run: |
        echo "🔄 Updating GitHub stats..."
        
        # Check if markers exist
        if ! grep -q "<!-- GITHUB-STATS:START -->" README.md; then
          echo "❌ Error: Please add <!-- GITHUB-STATS:START --> and <!-- GITHUB-STATS:END --> markers around your stats section in README.md"
          exit 1
        fi
        
        # Create backup
        cp README.md README.md.backup
        
        # Update stats section between markers
        sed -i '/<!-- GITHUB-STATS:START -->/,/<!-- GITHUB-STATS:END -->/c\
<!-- GITHUB-STATS:START -->\
📊 **GitHub Stats:**\
<p>\
  <img align="left" src="https://github-readme-stats.vercel.app/api/top-langs?username=Hrishita-Shah&show_icons=true&locale=en&layout=compact&theme=tokyonight&count_private=true&token=${{ secrets.GH_TOKEN }}" alt="Top Languages" />\
</p>\
<p>\
  <img align="centre" src="https://github-readme-stats.vercel.app/api?username=Hrishita-Shah&show_icons=true&theme=tokyonight&count_private=true&include_all_commits=true&token=${{ secrets.GH_TOKEN }}" alt="Hrishitas GitHub Stats" />\
</p>\
<div align="center">\
  <img src="https://github-readme-streak-stats.herokuapp.com/?user=Hrishita-Shah&theme=tokyonight&count_private=true" alt="GitHub Streak" />\
</div>\
<!-- GITHUB-STATS:END -->' README.md
        
        echo "✅ Stats section updated successfully"
        
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # Check if there are changes
        if git diff --quiet README.md; then
          echo "📊 No changes detected in README.md"
        else
          echo "📝 Changes detected, committing..."
          git add README.md
          git commit -m "🔄 Update GitHub stats with private contributions [skip ci]"
          git push
          echo "✅ README.md updated and pushed successfully!"
        fi
        
        # Clean up backup
        rm -f README.md.backup
